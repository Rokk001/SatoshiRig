version: "3.8"

services:
  satoshirig:
    container_name: satoshirig
    # Build from local Dockerfile (default)
    build:
      context: .
      dockerfile: Dockerfile
    # IMPORTANT: Do not use image: below if you want to build locally
    # Only uncomment image: and comment out build: if you have published this image to a registry
    # image: ghcr.io/rokk001/satoshirig:latest
    restart: unless-stopped
    environment:
      # REQUIRED: set your BTC wallet address
      - WALLET_ADDRESS=${WALLET_ADDRESS}
      # OPTIONAL: config path inside container
      - CONFIG_FILE=/app/config/config.toml
      # Compute backend: cpu | cuda | opencl
      - COMPUTE_BACKEND=${COMPUTE_BACKEND:-cpu}
      # GPU index for CUDA/OpenCL backends
      - GPU_DEVICE=${GPU_DEVICE:-0}
      # NVIDIA container runtime envs (only for NVIDIA GPU)
      - NVIDIA_VISIBLE_DEVICES=${NVIDIA_VISIBLE_DEVICES:-all}
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
      # Web dashboard port (default: 5000)
      - WEB_PORT=${WEB_PORT:-5000}
    volumes:
      - ./config:/app/config:ro
    ports:
      - "${WEB_PORT:-5000}:5000"
    # NVIDIA GPU support (required for NVIDIA GPU usage):
    # Uncomment the next line to enable NVIDIA runtime
    # This is required for containers that need NVIDIA GPU access
    # runtime: nvidia
    # Alternative: use deploy.resources.reservations.devices for newer Docker Compose
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: all
    #           capabilities: [gpu]
    # AMD/OpenCL (expose iGPU if used):
    # devices:
    #   - /dev/dri:/dev/dri
    command: ["python", "-m", "SatoshiRig"]
