# Docker Compose file for BUILD ONLY - no image references whatsoever
# Use this file if Docker is trying to pull ghcr.io/rokk001/satoshirig:latest
# Usage: docker-compose -f docker-compose.build.yml up -d

services:
  satoshirig:
    container_name: satoshirig
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      - CONFIG_FILE=/app/config/config.toml
      - COMPUTE_BACKEND=${COMPUTE_BACKEND:-cpu}
      - GPU_DEVICE=${GPU_DEVICE:-0}
      - NVIDIA_VISIBLE_DEVICES=${NVIDIA_VISIBLE_DEVICES:-all}
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
      - WEB_PORT=${WEB_PORT:-5000}
    volumes:
      - ./config:/app/config
      - ./data:/app/data
    ports:
      - "${WEB_PORT:-5000}:5000"
    # NVIDIA GPU support - uncomment if needed:
    # runtime: nvidia
    command: ["python", "-m", "SatoshiRig"]

